<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>To-do List (with Add Task Modal)</title>

  <!-- your CSS -->
  <link rel="stylesheet" href="customization.css" />

  <!-- jQuery + xlsx -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <!-- Bootstrap CSS & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    body {
      background-color: rgb(125, 186, 173);
    }

    /* small visual help: mark matched search */
    li.list-group-item.marked {
      background-color: #fff3b0 !important;
    }
  </style>
</head>

<body>
  <!-- Sidebar -->
  <div class="sidebar d-flex flex-column flex-shrink-0 p-3 text-bg-dark my-4">
    <hr />
    <ul class="nav nav-pills flex-column mb-auto">
      <li class="nav-item">
        <a href="#" id="homeLink" class="nav-link active" aria-current="page">
          <i class="bi bi-house-door-fill me-2"></i> Home
        </a>
      </li>

      <li class="nav-item">
        <a href="#" id="importantLink" class="nav-link text-white">
          <i class="bi bi-speedometer2 me-2"></i> Important Tasks
        </a>
      </li>
    </ul>
    <hr />
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand mx-4" href="#"><strong>To-Do list</strong></a>
      </div>
    </nav>

    <div class="container mx-auto my-5">
      <h1>What's on your mind?</h1>
    </div>

    <div class="container my-6">
      <div class="row justify-content-center">

        <!-- SMALL CARD CONTAINING THE ADD-BUTTON (kept as .custom-bg so existing hide logic works) -->
        <div class="col-md-6 col-lg-4 p-4 custom-bg rounded shadow">
          <div class="text-center">
            <!-- Button that opens the modal -->
            <button id="openAddModal" type="button" class="btn btn-primary btn" data-bs-toggle="modal"
              data-bs-target="#addTaskModal">
              <i class="bi bi-plus"></i> Add Task
            </button>
          </div>
        </div>

        <!-- Search Bar -->
        <div class="container my-3">
          <div class="row justify-content-center">
            <div class="col-md-6 col-lg-4">
              <input type="text" id="searchInput" class="form-control form-control-md text-center"
                placeholder="Search tasks..." />
            </div>
          </div>
        </div>

        <!-- Task Tabs -->
        <div id="tabb" class="container my-4">
          <ul class="nav nav-tabs justify-content-center">
            <li class="nav-item"><a class="nav-link active" id="todo-tab" data-bs-toggle="tab" href="#todo">TO-DO</a>
            </li>
            <li class="nav-item"><a class="nav-link" id="progress-tab" data-bs-toggle="tab" href="#progress">IN-PROGRESS</a>
            </li>
            <li class="nav-item"><a class="nav-link" id="done-tab" data-bs-toggle="tab" href="#done">DONE</a></li>
          </ul>

          <div class="tab-content mt-3">
            <div class="tab-pane fade show active" id="todo">
              <h4>To-Do Tasks</h4>
              <ul id="todoList" class="list-group"></ul>
            </div>

            <div class="tab-pane fade" id="progress">
              <h4>In-Progress Tasks</h4>
              <ul id="progressList" class="list-group"></ul>
            </div>

            <div class="tab-pane fade" id="done">
              <h4>Completed Tasks</h4>
              <ul id="doneList" class="list-group"></ul>
            </div>
          </div>
        </div>

        <!-- Important Tasks Section -->
        <div id="importantTasks" class="container my-4" style="display: none;">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h4 class="m-0">Important Tasks (High & Medium)</h4>
            <button id="backToBoard" class="btn btn-sm btn-secondary">Back to Board</button>
          </div>
          <ul id="importantList" class="list-group"></ul>
        </div>

        <!-- Download -->
        <div class="container mt-4 text-center">
          <button id="downloadExcel" class="btn btn-success">
            <i class="bi bi-download"></i> Download Tasks (Excel)
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ADD TASK MODAL -->
  <div class="modal fade" id="addTaskModal" tabindex="-1" aria-labelledby="addTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm"> <!-- modal-sm for a compact modal -->
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addTaskModalLabel">Add New Task</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <!-- Task name -->
          <div class="mb-3">
            <label for="modalTaskInput" class="form-label">Task</label>
            <input type="text" id="modalTaskInput" class="form-control" placeholder="e.g. Buy pizza" />
          </div>

          <!-- Description -->
          <div class="mb-3">
            <label for="modalDescInput" class="form-label">Description</label>
            <textarea id="modalDescInput" class="form-control" rows="3"
              placeholder="e.g. Order from corner shop"></textarea>
          </div>

          <!-- Priority -->
          <div class="mb-3">
            <label for="modalPriorityInput" class="form-label">Priority</label>
            <select id="modalPriorityInput" class="form-select">
              <option value="High">High ðŸ”´</option>
              <option value="Medium" selected>Medium ðŸŸ¡</option>
              <option value="Low">Low ðŸŸ¢</option>
            </select>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" id="cancelTaskBtn" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" id="saveTaskBtn" class="btn btn-primary">Save Task</button>
        </div>
      </div>
    </div>
  </div>
  <!-- END modal -->

  <!-- Bootstrap JS bundle (includes Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>

  <!-- App script -->
  <script>
    $(document).ready(function () {
      // single source of truth for tasks
      let tasks = [];
      const priorityOrder = { High: 1, Medium: 2, Low: 3 };

      // ---------- helpers ----------
      function escapeHtml(str) {
        if (!str) return '';
        return String(str)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');
      }

      function exportToExcel() {
        if (tasks.length === 0) {
          alert("No tasks to export.");
          return;
        }
        const worksheet = XLSX.utils.json_to_sheet(tasks);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "Tasks");
        XLSX.writeFile(workbook, "tasks.xlsx");
      }

      // ---------- important rendering ----------
      function renderImportant() {
        const $list = $('#importantList');
        $list.empty();

        // only High & Medium
        const filtered = tasks.filter(t => t.Priority === "High" || t.Priority === "Medium");
        const sorted = filtered.sort((a, b) => (priorityOrder[a.Priority] || 4) - (priorityOrder[b.Priority] || 4));

        if (sorted.length === 0) {
          $list.append('<li class="list-group-item">No important tasks available</li>');
          return;
        }

        sorted.forEach(t => {
          const badgeClass = t.Priority === 'High' ? 'bg-danger' : 'bg-warning text-dark';
          const item = `
            <li class="list-group-item d-flex justify-content-between align-items-start">
              <div>
                <strong>${escapeHtml(t.Task)}</strong>
                <span class="badge ${badgeClass} ms-2">${escapeHtml(t.Priority)}</span><br>
                <small>${escapeHtml(t.Description)}</small>
              </div>
            </li>`;
          $list.append(item);
        });
      }

      // ---------- modal setup ----------
      // create a Bootstrap modal instance we can control (hide programmatically)
      const addTaskModal = new bootstrap.Modal(document.getElementById('addTaskModal'));

      // when modal opens, focus the task input
      document.getElementById('addTaskModal').addEventListener('shown.bs.modal', function () {
        $('#modalTaskInput').trigger('focus');
      });

      // ---------- sidebar Important behavior ----------
      $('#importantLink').click(function (e) {
        e.preventDefault();
        // hide board + inputs
        $('#tabb').hide();
        $('.custom-bg').hide();
        $('#searchInput').closest('.container').hide();
        $('#downloadExcel').hide();

        // show important
        $('#importantTasks').show();
        renderImportant();

        // highlight active sidebar link
        $('#importantLink').addClass('active');
        $('#homeLink').removeClass('active');
      });

      // back to board
      $('#backToBoard, #homeLink').click(function (e) {
        e.preventDefault();
        $('#importantTasks').hide();
        $('#tabb').show();
        $('.custom-bg').show();
        $('#searchInput').closest('.container').show();
        $('#downloadExcel').show();

        $('#homeLink').addClass('active');
        $('#importantLink').removeClass('active');
      });

      // ---------- save from modal (Add Task) ----------
      $('#saveTaskBtn').click(function () {
        const taskValue = $('#modalTaskInput').val().trim();
        const descValue = $('#modalDescInput').val().trim();
        const priorityValue = $('#modalPriorityInput').val();

        if (!taskValue) {
          alert('Please enter a task name.');
          return;
        }

        // add to array (single source of truth)
        tasks.push({ Task: taskValue, Description: descValue, Priority: priorityValue, Status: "To-Do" });

        // render important view (keeps sidebar view up-to-date)
        renderImportant();

        // append to To-Do list (UI)
        const badgeClass = priorityValue === "High" ? "bg-danger" :
          priorityValue === "Medium" ? "bg-warning text-dark" : "bg-success";

        const todoHTML = `
          <li class="list-group-item d-flex justify-content-between align-items-start">
            <div>
              <strong>${escapeHtml(taskValue)}</strong>
              <span class="badge ${badgeClass} ms-2">${priorityValue}</span><br>
              <small>${escapeHtml(descValue)}</small>
            </div>
            <div>
              <button class="btn btn-sm btn-primary start-btn me-2"><i class="bi bi-play-fill"></i></button>
              <button class="btn btn-sm btn-dark delete-btn"><i class="bi bi-trash3"></i></button>
            </div>
          </li>`;
        $('#todoList').append(todoHTML);

        // clear modal inputs
        $('#modalTaskInput').val('');
        $('#modalDescInput').val('');
        $('#modalPriorityInput').val('Medium');

        // hide modal programmatically
        addTaskModal.hide();
      });

      // ---------- rest of your handlers (delete / start / complete / redo) ----------
      $(document).on('click', '.delete-btn', function () {
        const listItem = $(this).closest('li');
        const taskValue = listItem.find('strong').text();
        tasks = tasks.filter(t => t.Task !== taskValue);
        listItem.remove();
        renderImportant();
      });

      $(document).on('click', '.start-btn', function () {
        const listItem = $(this).closest('li');
        const taskValue = listItem.find('strong').text();
        const descValue = listItem.find('small').text();
        const priorityValue = listItem.find('.badge').text();

        tasks = tasks.map(t => t.Task === taskValue ? { ...t, Status: "In Progress" } : t);
        renderImportant();

        const badgeClass = priorityValue === "High" ? "bg-danger" :
          priorityValue === "Medium" ? "bg-warning text-dark" : "bg-success";

        $('#progressList').append(`
          <li class="list-group-item d-flex justify-content-between align-items-start">
            <div>
              <strong>${escapeHtml(taskValue)}</strong>
              <span class="badge ${badgeClass} ms-2">${priorityValue}</span><br>
              <small>${escapeHtml(descValue)}</small>
            </div>
            <div>
              <button class="btn btn-sm btn-success complete-btn me-2"><i class="bi bi-check2"></i></button>
              <button class="btn btn-sm btn-dark delete-btn"><i class="bi bi-trash3"></i></button>
            </div>
          </li>`);
        listItem.remove();
      });

      $(document).on('click', '.complete-btn', function () {
        const listItem = $(this).closest('li');
        const taskValue = listItem.find('strong').text();
        const descValue = listItem.find('small').text();
        const priorityValue = listItem.find('.badge').text();

        tasks = tasks.map(t => t.Task === taskValue ? { ...t, Status: "Done" } : t);
        renderImportant();

        const badgeClass = priorityValue === "High" ? "bg-danger" :
          priorityValue === "Medium" ? "bg-warning text-dark" : "bg-success";

        $('#doneList').append(`
          <li class="list-group-item d-flex justify-content-between align-items-start">
            <div>
              <strong>${escapeHtml(taskValue)}</strong>
              <span class="badge ${badgeClass} ms-2">${priorityValue}</span><br>
              <small>${escapeHtml(descValue)}</small>
            </div>
            <div>
              <button class="btn btn-sm btn-warning redo-btn me-2"><i class="bi bi-arrow-counterclockwise"></i></button>
              <button class="btn btn-sm btn-dark delete-btn"><i class="bi bi-trash3"></i></button>
            </div>
          </li>`);
        listItem.remove();
      });

      $(document).on('click', '.redo-btn', function () {
        const listItem = $(this).closest('li');
        const taskValue = listItem.find('strong').text();
        const descValue = listItem.find('small').text();
        const priorityValue = listItem.find('.badge').text();

        tasks = tasks.map(t => t.Task === taskValue ? { ...t, Status: "To-Do" } : t);
        renderImportant();

        const badgeClass = priorityValue === "High" ? "bg-danger" :
          priorityValue === "Medium" ? "bg-warning text-dark" : "bg-success";

        $('#todoList').append(`
          <li class="list-group-item d-flex justify-content-between align-items-start">
            <div>
              <strong>${escapeHtml(taskValue)}</strong>
              <span class="badge ${badgeClass} ms-2">${priorityValue}</span><br>
              <small>${escapeHtml(descValue)}</small>
            </div>
            <div>
              <button class="btn btn-sm btn-primary start-btn me-2"><i class="bi bi-play-fill"></i></button>
              <button class="btn btn-sm btn-dark delete-btn"><i class="bi bi-trash3"></i></button>
            </div>
          </li>`);
        listItem.remove();
      });

      // Live search (highlight matches)
      $('#searchInput').on('input', function () {
        const q = $(this).val().toLowerCase();
        $('li.list-group-item').each(function () {
          const txt = $(this).text().toLowerCase();
          if (q !== "" && txt.includes(q)) {
            $(this).addClass('marked');
          } else {
            $(this).removeClass('marked');
          }
        });
      });

      // Excel download
      $('#downloadExcel').click(function () {
        exportToExcel();
      });

    }); // end document ready
  </script>
</body>

</html>
