<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-do List</title>
    <link rel="stylesheet" href="customization.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        body {
            background-color: rgb(125, 186, 173);
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar d-flex flex-column flex-shrink-0 p-3 text-bg-dark my-4">
        <hr>
        <ul class="nav nav-pills flex-column mb-auto">
            <li class="nav-item">
                <a href="#" id="homeLink" class="nav-link active" aria-current="page">
                    <i class="bi bi-house-door-fill me-2"></i> Home
                </a>
            </li>
            <li class="nav-item">
                <a href="#" id="importantLink" class="nav-link text-white">
                    <i class="bi bi-speedometer2 me-2"></i> Important Tasks
                </a>
            </li>
        </ul>
        <hr>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
            <div class="container-fluid ">
                <a class="navbar-brand mx-4" href="#"><strong>To-Do list</strong></a>
            </div>
        </nav>

        <div id="heading" class="container mx-auto my-5">
            <h1>What's on your mind?</h1>
        </div>

        <div class="container my-6">
            <div class="row justify-content-center">
                <div class="col-md-6 col-lg-4 p-4 custom-bg rounded shadow">
                    <!-- Task input -->
                    <div class="mb-3">
                        <label for="taskInput" class="form-label">Task:</label>
                        <input type="text" class="form-control" id="taskInput"
                            placeholder="e.g. Pick up 4kg of tomatoes">
                    </div>

                    <div class="mb-3">
                        <label for="descInput" class="form-label">Description:</label>
                        <textarea class="form-control" id="descInput" rows="3"
                            placeholder="e.g. From the farmer's market before 6 PM"></textarea>
                    </div>

                    <div class="mb-3">
                        <label for="priorityInput" class="form-label">Priority:</label>
                        <select class="form-select" id="priorityInput">
                            <option value="High">High ðŸ”´</option>
                            <option value="Medium" selected>Medium ðŸŸ¡</option>
                            <option value="Low">Low ðŸŸ¢</option>
                        </select>
                    </div>

                    <div class="text-center">
                        <button id="taskbtn" class="btn btn-dark mt-3">Add Task
                            <i class="bi bi-file-plus-fill"></i>
                        </button>
                    </div>
                </div>

                <!-- Search Bar -->
                <div class="container my-3">
                    <div class="row justify-content-center">
                        <div class="col-md-6 col-lg-4">
                            <input type="text" id="searchInput" class="form-control form-control-md text-center"
                                placeholder="Search tasks...">
                            <button id="searchBtn" class="btn btn-primary mt-2 w-100">Search</button>
                        </div>
                    </div>
                </div>

                <!-- Task Tabs -->
                <div id="tabb" class="container my-4">
                    <ul class="nav nav-tabs justify-content-center">
                        <li class="nav-item"><a class="nav-link active" id="todo-tab" data-bs-toggle="tab"
                                href="#todo">TO-DO</a></li>
                        <li class="nav-item"><a class="nav-link" id="progress-tab" data-bs-toggle="tab"
                                href="#progress">IN-PROGRESS</a></li>
                        <li class="nav-item"><a class="nav-link" id="done-tab" data-bs-toggle="tab"
                                href="#done">DONE</a></li>
                    </ul>

                    <div class="tab-content mt-3">
                        <div class="tab-pane fade show active" id="todo">
                            <h4>To-Do Tasks</h4>
                            <ul id="todoList" class="list-group"></ul>
                        </div>
                        <div class="tab-pane fade" id="progress">
                            <h4>In-Progress Tasks</h4>
                            <ul id="progressList" class="list-group"></ul>
                        </div>
                        <div class="tab-pane fade" id="done">
                            <h4>Completed Tasks</h4>
                            <ul id="doneList" class="list-group"></ul>
                        </div>
                    </div>
                </div>

                <!-- Important Tasks Section -->
                <div id="importantTasks" class="container my-4" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h4 class="m-0">Important Tasks (sorted by priority)</h4>
                        <button id="backToBoard" class="btn btn-sm btn-secondary">Back to Board</button>
                    </div>
                    <ul id="importantList" class="list-group"></ul>
                </div>

                <!-- Download -->
                <div class="container mt-4 text-center">
                    <button id="downloadExcel" class="btn btn-success">
                        <i class="bi bi-download"></i> Download Tasks (Excel)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function () {
            let tasks = [];
            const priorityOrder = { High: 1, Medium: 2, Low: 3 };

            // Escape HTML
            function escapeHtml(str) {
                if (!str) return '';
                return String(str)
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#39;');
            }

            // Export to Excel
            function exportToExcel() {
                if (tasks.length === 0) {
                    alert("No tasks to export.");
                    return;
                }
                const worksheet = XLSX.utils.json_to_sheet(tasks);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, "Tasks");
                XLSX.writeFile(workbook, "tasks.xlsx");
            }

            // Render Important Tasks (only High & Medium)
            function renderImportant() {
                const $list = $('#importantList');
                $list.empty();
                const filtered = tasks.filter(t => t.Priority === "High" || t.Priority === "Medium");
                const sorted = filtered.sort((a, b) => (priorityOrder[a.Priority] || 4) - (priorityOrder[b.Priority] || 4));
                if (sorted.length === 0) {
                    $list.append('<li class="list-group-item">No important tasks available</li>');
                    return;
                }
                sorted.forEach(t => {
                    const badgeClass = t.Priority === 'High' ? 'bg-danger' : 'bg-warning text-dark';
                    const item = `
          <li class="list-group-item d-flex justify-content-between align-items-start">
            <div>
              <strong>${escapeHtml(t.Task)}</strong>
              <span class="badge ${badgeClass} ms-2">${escapeHtml(t.Priority)}</span><br>
              <small>${escapeHtml(t.Description)}</small>
            </div>
          </li>`;
                    $list.append(item);
                });
            }

            // Sidebar: show Important
            $('#importantLink').click(function (e) {
                e.preventDefault();
                
                // Hide everything else
                $('#tabb').hide();             // Hide task tabs
                $('.custom-bg').hide();        // Hide input form
                $('#searchInput').closest('.container').hide(); // Hide search bar
                $('#downloadExcel').hide();    // Hide Excel button
                // $('#heading').hide();    // Hide heading button


                // Show important
                $('#importantTasks').show();

                renderImportant();

                // highlight sidebar
                $('#importantLink').addClass('active');
                $('#homeLink').removeClass('active');
            });

            // Sidebar: back to Board/Home
            $('#backToBoard, #homeLink').click(function (e) {
                e.preventDefault();

                // Show everything again
                $('#tabb').show();
                $('.custom-bg').show();
                $('#searchInput').closest('.container').show();
                $('#downloadExcel').show();

                $('#importantTasks').hide();

                $('#homeLink').addClass('active');
                $('#importantLink').removeClass('active');
            });

            // Add Task
            $('#taskbtn').click(function () {
                const taskValue = $('#taskInput').val().trim();
                const descValue = $('#descInput').val().trim();
                const priorityValue = $('#priorityInput').val();
                if (taskValue === "") {
                    alert("Please enter a task!");
                    return;
                }
                tasks.push({ Task: taskValue, Description: descValue, Priority: priorityValue, Status: "To-Do" });
                renderImportant();
                const badgeClass = priorityValue === "High" ? "bg-danger" :
                    priorityValue === "Medium" ? "bg-warning text-dark" : "bg-success";
                const todoHTML = `
        <li class="list-group-item d-flex justify-content-between align-items-start">
          <div>
            <strong>${escapeHtml(taskValue)}</strong>
            <span class="badge ${badgeClass} ms-2">${priorityValue}</span><br>
            <small>${escapeHtml(descValue)}</small>
          </div>
          <div>
            <button class="btn btn-sm btn-primary start-btn me-2"><i class="bi bi-play-fill"></i></button>
            <button class="btn btn-sm btn-dark delete-btn"><i class="bi bi-trash3"></i></button>
          </div>
        </li>`;
                $('#todoList').append(todoHTML);
                $('#taskInput').val('');
                $('#descInput').val('');
                $('#priorityInput').val('Medium');
            });

            // Delete Task
            $(document).on('click', '.delete-btn', function () {
                const listItem = $(this).closest('li');
                const taskValue = listItem.find('strong').text();
                tasks = tasks.filter(t => t.Task !== taskValue);
                listItem.remove();
                renderImportant();
            });

            // Start Task
            $(document).on('click', '.start-btn', function () {
                const listItem = $(this).closest('li');
                const taskValue = listItem.find('strong').text();
                const descValue = listItem.find('small').text();
                const priorityValue = listItem.find('.badge').text();
                tasks = tasks.map(t => t.Task === taskValue ? { ...t, Status: "In Progress" } : t);
                renderImportant();
                const badgeClass = priorityValue === "High" ? "bg-danger" :
                    priorityValue === "Medium" ? "bg-warning text-dark" : "bg-success";
                $('#progressList').append(`
        <li class="list-group-item d-flex justify-content-between align-items-start">
          <div>
            <strong>${escapeHtml(taskValue)}</strong>
            <span class="badge ${badgeClass} ms-2">${priorityValue}</span><br>
            <small>${escapeHtml(descValue)}</small>
          </div>
          <div>
            <button class="btn btn-sm btn-success complete-btn me-2"><i class="bi bi-check2"></i></button>
            <button class="btn btn-sm btn-dark delete-btn"><i class="bi bi-trash3"></i></button>
          </div>
        </li>`);
                listItem.remove();
            });

            // Complete Task
            $(document).on('click', '.complete-btn', function () {
                const listItem = $(this).closest('li');
                const taskValue = listItem.find('strong').text();
                const descValue = listItem.find('small').text();
                const priorityValue = listItem.find('.badge').text();
                tasks = tasks.map(t => t.Task === taskValue ? { ...t, Status: "Done" } : t);
                renderImportant();
                const badgeClass = priorityValue === "High" ? "bg-danger" :
                    priorityValue === "Medium" ? "bg-warning text-dark" : "bg-success";
                $('#doneList').append(`
        <li class="list-group-item d-flex justify-content-between align-items-start">
          <div>
            <strong>${escapeHtml(taskValue)}</strong>
            <span class="badge ${badgeClass} ms-2">${priorityValue}</span><br>
            <small>${escapeHtml(descValue)}</small>
          </div>
          <div>
            <button class="btn btn-sm btn-warning redo-btn me-2"><i class="bi bi-arrow-counterclockwise"></i></button>
            <button class="btn btn-sm btn-dark delete-btn"><i class="bi bi-trash3"></i></button>
          </div>
        </li>`);
                listItem.remove();
            });

            // Redo Task
            $(document).on('click', '.redo-btn', function () {
                const listItem = $(this).closest('li');
                const taskValue = listItem.find('strong').text();
                const descValue = listItem.find('small').text();
                const priorityValue = listItem.find('.badge').text();
                tasks = tasks.map(t => t.Task === taskValue ? { ...t, Status: "To-Do" } : t);
                renderImportant();
                const badgeClass = priorityValue === "High" ? "bg-danger" :
                    priorityValue === "Medium" ? "bg-warning text-dark" : "bg-success";
                $('#todoList').append(`
        <li class="list-group-item d-flex justify-content-between align-items-start">
          <div>
            <strong>${escapeHtml(taskValue)}</strong>
            <span class="badge ${badgeClass} ms-2">${priorityValue}</span><br>
            <small>${escapeHtml(descValue)}</small>
          </div>
          <div>
            <button class="btn btn-sm btn-primary start-btn me-2"><i class="bi bi-play-fill"></i></button>
            <button class="btn btn-sm btn-dark delete-btn"><i class="bi bi-trash3"></i></button>
          </div>
        </li>`);
                listItem.remove();
            });

            // Live Search with highlight
            $('#searchInput').on('input', function () {
                const searchTerm = $(this).val().toLowerCase();
                $('li.list-group-item').each(function () {
                    const taskText = $(this).text().toLowerCase();
                    if (searchTerm !== "" && taskText.includes(searchTerm)) {
                        $(this).css("background-color", "yellow");
                    } else {
                        $(this).css("background-color", "");
                    }
                });
            });

            // Excel download
            $('#downloadExcel').click(function () {
                exportToExcel();
            });
        });
    </script>


</body>

</html>
